## Урок 22

1. **news/forms.py**:
   - **Импорт моделей Article и Tag**: Добавлены импорты моделей `Article` и `Tag` для использования в форме.
   - **Изменение класса ArticleForm**: Класс `ArticleForm` изменен с `forms.Form` на `forms.ModelForm`. Это изменение сделано для упрощения работы с моделью `Article` и автоматического создания полей формы на основе модели.
   - **Добавление поля tags**: Добавлено новое поле `tags`, которое является множественным выбором (`ModelMultipleChoiceField`) с использованием модели `Tag`. Поле использует виджет `CheckboxSelectMultiple` и не является обязательным для заполнения. Это изменение сделано для того, чтобы пользователи могли выбирать несколько тегов для новой статьи.
   - **Добавление класса Meta**: Добавлен внутренний класс `Meta` для определения модели и полей, которые будут использоваться в форме. В классе `Meta` определены поля `title`, `content`, `category` и `tags`, а также виджеты и метки для этих полей. Это изменение сделано для автоматического создания полей формы на основе модели и упрощения работы с формой.

### Объяснение как это работает

1. **Определение формы (news/forms.py)**:
   - Форма `ArticleForm` определена с использованием класса `forms.ModelForm`. Она содержит поля `title`, `content`, `category` и `tags`. Поле `title` использует виджет `CharField` с максимальной длиной 100 символов и стилем Bootstrap. Поле `content` использует виджет `Textarea` с максимальной длиной 5000 символов и стилем Bootstrap. Поле `category` использует виджет `ModelChoiceField` для выбора категории из модели `Category` и стилем Bootstrap. Поле `tags` использует виджет `ModelMultipleChoiceField` для множественного выбора тегов из модели `Tag`.

2. **Шаблон для добавления статьи (news/templates/news/add_article.html)**:
   - Шаблон `add_article.html` расширяет базовый шаблон и содержит форму для добавления новой статьи. Форма отправляется методом POST и содержит кнопку отправки. Шаблон использует тег `{% csrf_token %}` для защиты от CSRF-атак.
   - Каждое поле формы отображается отдельно с использованием цикла `{% for field in form %}`. Для каждого поля отображается метка (`label_tag`) и само поле (`field`). Если у поля есть ошибки, они отображаются в элементе `<div class="alert alert-danger mt-1">`.
   - Добавлена колонка с подсказкой по заполнению формы для улучшения пользовательского опыта.

3. **Маршрут для добавления статьи (news/urls.py)**:
   - Добавлен новый маршрут `path('add/', views.add_article, name='add_article')` для обработки запросов на добавление новой статьи. Маршрут связывает URL `/add/` с представлением `add_article`.

4. **Представление для добавления статьи (news/views.py)**:
   - Функция `add_article` обрабатывает запросы на добавление новой статьи. Она проверяет метод запроса (POST или GET). Если метод POST, создается экземпляр формы `ArticleForm` с данными из запроса, проверяется валидность данных формы и, при успешной валидации, создается объект `Article` с данными из формы и сохраняется в базе данных. После сохранения статьи пользователь перенаправляется на страницу карточки новости. Если метод GET, создается пустой экземпляр формы `ArticleForm`. Контекст содержит форму и меню, и шаблон `add_article.html` рендерится с этим контекстом.

**commit: `Урок 22: переделали форму на ModelForm`**

1. **news/models.py**:
   - **Добавление поля image**: В модель `Article` добавлено новое поле `image`, которое является полем для загрузки изображений (`ImageField`). Поле использует параметр `upload_to='articles/'` для указания директории загрузки, `blank=True` для разрешения пустых значений и `null=True` для разрешения значений NULL в базе данных. Поле имеет метку `Изображение`. Это изменение сделано для того, чтобы пользователи могли загружать изображения для статей.

2. **requirements.txt**:
   - **Добавление библиотеки Pillow**: В файл `requirements.txt` добавлена библиотека `Pillow==10.3.0`. Это изменение сделано для установки библиотеки Pillow, которая необходима для работы с изображениями в Django.

### Объяснение:

**Поле ImageField в Django**:
Поле `ImageField` в Django используется для загрузки и хранения изображений. Оно позволяет пользователям загружать изображения через формы и сохранять их в указанной директории на сервере. Поле `ImageField` требует установки библиотеки Pillow для работы с изображениями.

**Библиотека Pillow**:
Pillow — это библиотека Python для работы с изображениями. Она предоставляет мощные инструменты для открытия, манипуляции и сохранения многих различных форматов изображений. Pillow необходима для работы с полем `ImageField` в Django.

**Как работает этот код**:

1. **Определение модели Article (news/models.py)**:
   - В модели `Article` добавлено новое поле `image`, которое является полем для загрузки изображений (`ImageField`). Поле использует параметр `upload_to='articles/'` для указания директории загрузки, `blank=True` для разрешения пустых значений и `null=True` для разрешения значений NULL в базе данных. Поле имеет метку `Изображение`.

2. **Установка библиотеки Pillow (requirements.txt)**:
   - В файл `requirements.txt` добавлена библиотека `Pillow==10.3.0`. Это необходимо для установки библиотеки Pillow, которая требуется для работы с изображениями в Django.

### Список используемых тегов и стилей с их описанием

1. **Django поля**:
   - `ImageField`: Поле для загрузки и хранения изображений.
   - `upload_to`: Параметр для указания директории загрузки изображений.
   - `blank=True`: Параметр для разрешения пустых значений в поле.
   - `null=True`: Параметр для разрешения значений NULL в базе данных.
   - `verbose_name`: Параметр для указания метки поля.

2. **Библиотека Pillow**:
   - `Pillow`: Библиотека Python для работы с изображениями.

**commit: `Урок 22: добавили поле для хранения изображений в статьях`**

1. **news/views.py**:
   - **Изменение обработки формы в функции add_article**: В функции `add_article` изменена обработка формы при методе POST. Теперь форма создается с использованием `request.POST` и `request.FILES`, что позволяет обрабатывать загрузку файлов. Это изменение сделано для поддержки загрузки изображений при добавлении статьи.
   - **Изменение сохранения статьи**: Удалены строки, которые вручную создавали объект `Article` и сохраняли его в базе данных. Теперь используется метод `form.save()`, который автоматически создает и сохраняет объект `Article` на основе данных формы. Это изменение сделано для упрощения кода и автоматического сохранения статьи в базе данных.
   - **Изменение перенаправления**: Изменен способ перенаправления пользователя после успешного сохранения статьи. Теперь используется функция `redirect` с именем маршрута `news:detail_article_by_id` и параметром `article_id=article.id`. Это изменение сделано для улучшения читаемости кода и использования именованных маршрутов.
   - **Изменение контекста**: Удалены лишние фигурные скобки в контексте. Теперь контекст создается с использованием словаря, что упрощает код и делает его более читаемым.

**Как работает этот код**:

1. **Определение функции add_article (news/views.py)**:
   - Функция `add_article` обрабатывает запросы на добавление новой статьи. Она проверяет метод запроса (POST или GET). Если метод POST, создается экземпляр формы `ArticleForm` с данными из запроса (`request.POST` и `request.FILES`), проверяется валидность данных формы и, при успешной валидации, создается и сохраняется объект `Article` с данными из формы. После сохранения статьи пользователь перенаправляется на страницу карточки новости. Если метод GET, создается пустой экземпляр формы `ArticleForm`. Контекст содержит форму и меню, и шаблон `add_article.html` рендерится с этим контекстом.

2. **Обработка загрузки файлов**:
   - В функции `add_article` теперь используется `request.FILES` для обработки загрузки файлов. Это позволяет пользователям загружать изображения при добавлении статьи.

3. **Автоматическое сохранение статьи**:
   - Вместо ручного создания и сохранения объекта `Article`, теперь используется метод `form.save()`, который автоматически создает и сохраняет объект `Article` на основе данных формы. Это упрощает код и делает его более читаемым.

4. **Перенаправление пользователя**:
   - После успешного сохранения статьи пользователь перенаправляется на страницу карточки новости с использованием функции `redirect` и именованного маршрута `news:detail_article_by_id`. Это улучшает читаемость кода и использование именованных маршрутов.

5. **Создание контекста**:
   - Контекст создается с использованием словаря, что упрощает код и делает его более читаемым.

**commit: `Урок 22: обновили представление add_article`**

- Настроили пути для медиа-файлов
- Добавили обработку медиа в режиме разработки

**commit: `Урок 22: добавили папку /media/articles`**

1. **news/templates/news/delete_article.html**:
   - **Создание шаблона для удаления статьи**: Создан новый шаблон `delete_article.html`, который расширяет базовый шаблон и содержит форму для удаления статьи. Форма отправляется методом POST и содержит кнопку для подтверждения удаления и кнопку для отмены. Это изменение сделано для предоставления пользователям интерфейса для удаления статей.

2. **news/templates/news/edit_article.html**:
   - **Создание шаблона для редактирования статьи**: Создан новый шаблон `edit_article.html`, который расширяет базовый шаблон и содержит форму для редактирования статьи. Форма отправляется методом POST и содержит кнопку для сохранения изменений и кнопку для отмены. Это изменение сделано для предоставления пользователям интерфейса для редактирования статей.

3. **news/urls.py**:
   - **Добавление новых маршрутов**: Добавлены новые маршруты `path('edit/<int:article_id>/', views.article_update, name='article_update')` и `path('delete/<int:article_id>/', views.article_delete, name='article_delete')` для обработки запросов на редактирование и удаление статей соответственно. Это изменение сделано для поддержки новой функциональности редактирования и удаления статей.

4. **news/views.py**:
   - **Добавление функции article_update**: Добавлена новая функция `article_update`, которая обрабатывает запросы на редактирование статьи. Функция проверяет метод запроса (POST или GET). Если метод POST, создается экземпляр формы `ArticleForm` с данными из запроса (`request.POST` и `request.FILES`) и экземпляром статьи, проверяется валидность данных формы и, при успешной валидации, сохраняется экземпляр статьи. После сохранения статьи пользователь перенаправляется на страницу карточки новости. Если метод GET, создается экземпляр формы `ArticleForm` с экземпляром статьи. Контекст содержит форму и статью, и шаблон `edit_article.html` рендерится с этим контекстом.
   - **Добавление функции article_delete**: Добавлена новая функция `article_delete`, которая обрабатывает запросы на удаление статьи. Функция проверяет метод запроса (POST или GET). Если метод POST, удаляется экземпляр статьи и пользователь перенаправляется на страницу каталога новостей. Если метод GET, рендерится шаблон `delete_article.html` с контекстом, содержащим статью.

**Как работает этот код**:

1. **Шаблон для удаления статьи (news/templates/news/delete_article.html)**:
   - Шаблон `delete_article.html` расширяет базовый шаблон и содержит форму для удаления статьи. Форма отправляется методом POST и содержит кнопку для подтверждения удаления и кнопку для отмены. Шаблон использует тег `{% csrf_token %}` для защиты от CSRF-атак.

2. **Шаблон для редактирования статьи (news/templates/news/edit_article.html)**:
   - Шаблон `edit_article.html` расширяет базовый шаблон и содержит форму для редактирования статьи. Форма отправляется методом POST и содержит кнопку для сохранения изменений и кнопку для отмены. Шаблон использует тег `{% csrf_token %}` для защиты от CSRF-атак.

3. **Маршруты для редактирования и удаления статьи (news/urls.py)**:
   - Добавлены новые маршруты `path('edit/<int:article_id>/', views.article_update, name='article_update')` и `path('delete/<int:article_id>/', views.article_delete, name='article_delete')` для обработки запросов на редактирование и удаление статей соответственно. Маршруты связывают URL `/edit/<int:article_id>/` и `/delete/<int:article_id>/` с представлениями `article_update` и `article_delete` соответственно.

4. **Представление для редактирования статьи (news/views.py)**:
   - Функция `article_update` обрабатывает запросы на редактирование статьи. Она проверяет метод запроса (POST или GET). Если метод POST, создается экземпляр формы `ArticleForm` с данными из запроса (`request.POST` и `request.FILES`) и экземпляром статьи, проверяется валидность данных формы и, при успешной валидации, сохраняется экземпляр статьи. После сохранения статьи пользователь перенаправляется на страницу карточки новости. Если метод GET, создается экземпляр формы `ArticleForm` с экземпляром статьи. Контекст содержит форму и статью, и шаблон `edit_article.html` рендерится с этим контекстом.

5. **Представление для удаления статьи (news/views.py)**:
   - Функция `article_delete` обрабатывает запросы на удаление статьи. Она проверяет метод запроса (POST или GET). Если метод POST, удаляется экземпляр статьи и пользователь перенаправляется на страницу каталога новостей. Если метод GET, рендерится шаблон `delete_article.html` с контекстом, содержащим статью.

### Список используемых тегов и стилей с их описанием

1. **HTML теги**:
   - `<form>`: Форма для отправки данных.
   - `<input>`: Поле ввода для формы.
   - `<button>`: Кнопка для отправки формы.
   - `<h1>`: Заголовок первого уровня.
   - `<div>`: Контейнер для группировки элементов.
   - `<a>`: Гиперссылка.
   - `{% csrf_token %}`: Тег для защиты от CSRF-атак.
   - `{% extends "base.html" %}`: Тег для расширения базового шаблона.
   - `{% block content %}`: Тег для определения блока контента.
   - `{% endblock %}`: Тег для завершения блока контента.

2. **Bootstrap классы**:
   - `btn btn-danger`: Стиль для кнопки удаления.
   - `btn btn-secondary`: Стиль для кнопки отмены.
   - `btn btn-primary`: Стиль для кнопки сохранения.
   - `mt-3`: Отступ сверху.

**commit: `Урок 22: добавили формы для редактирования и удаления статей`**

1. **news/templates/news/article_detail.html**:
   - **Добавление контейнера для кнопок редактирования и удаления**: Добавлен новый контейнер `<div class="mt-4 border-top pt-3">` для размещения кнопок редактирования и удаления статьи. Это изменение сделано для улучшения структуры страницы и удобства пользователей.
   - **Добавление кнопки редактирования**: Добавлена кнопка `<a href="{% url 'news:article_update' article.id %}" class="btn btn-warning">` для редактирования статьи. Кнопка содержит иконку `<i class="bi bi-pencil-square"></i>` и текст "Редактировать". Это изменение сделано для предоставления пользователям возможности редактировать статью.
   - **Добавление кнопки удаления**: Добавлена кнопка `<a href="{% url 'news:article_delete' article.id %}" class="btn btn-danger">` для удаления статьи. Кнопка содержит иконку `<i class="bi bi-trash"></i>` и текст "Удалить". Это изменение сделано для предоставления пользователям возможности удалять статью.

**Как работает этот код**:

1. **Шаблон для отображения статьи (news/templates/news/article_detail.html)**:
   - Шаблон `article_detail.html` расширяет базовый шаблон и содержит информацию о статье. В шаблоне добавлен новый контейнер `<div class="mt-4 border-top pt-3">` для размещения кнопок редактирования и удаления статьи.
   - Добавлена кнопка `<a href="{% url 'news:article_update' article.id %}" class="btn btn-warning">` для редактирования статьи. Кнопка содержит иконку `<i class="bi bi-pencil-square"></i>` и текст "Редактировать".
   - Добавлена кнопка `<a href="{% url 'news:article_delete' article.id %}" class="btn btn-danger">` для удаления статьи. Кнопка содержит иконку `<i class="bi bi-trash"></i>` и текст "Удалить".

### Список используемых тегов и стилей с их описанием

1. **HTML теги**:
   - `<div>`: Контейнер для группировки элементов.
   - `<a>`: Гиперссылка для навигации.
   - `<i>`: Иконка для визуального оформления.
   - `{% csrf_token %}`: Тег для защиты от CSRF-атак.
   - `{% extends "base.html" %}`: Тег для расширения базового шаблона.
   - `{% block content %}`: Тег для определения блока контента.
   - `{% endblock %}`: Тег для завершения блока контента.
   - `{% include "include/search_form.html" %}`: Тег для включения другого шаблона.

2. **Bootstrap классы**:
   - `mt-4`: Отступ сверху.
   - `border-top`: Граница сверху.
   - `pt-3`: Внутренний отступ сверху.
   - `btn btn-warning`: Стиль для кнопки редактирования.
   - `btn btn-danger`: Стиль для кнопки удаления.
   - `bi bi-pencil-square`: Иконка карандаша для редактирования.
   - `bi bi-trash`: Иконка корзины для удаления.

**commit: `Урок 22: добавили кнопки удаления и редактирования на странице статей`**

1. **news/forms.py**:
   - **Добавление поля image в Meta**: В классе `Meta` формы `ArticleForm` добавлено поле `image` и виджет `ClearableFileInput` для загрузки изображений. Это изменение сделано для того, чтобы пользователи могли загружать изображения при добавлении статьи.

2. **news/models.py**:
   - **Изменение параметра upload_to поля image**: В поле `image` модели `Article` изменен параметр `upload_to` на `'articles/%Y/%m/%d/'`, чтобы изображения сохранялись в директории с подкаталогами по году, месяцу и дню. Это изменение сделано для улучшения организации загруженных изображений.

3. **news/templates/news/add_article.html**:
   - **Изменение структуры шаблона**: Удалены лишние контейнеры и добавлены новые элементы для улучшения структуры и визуального оформления шаблона.
   - **Добавление поля для загрузки изображения**: Добавлено поле для загрузки изображения с использованием виджета `ClearableFileInput`. Это изменение сделано для того, чтобы пользователи могли загружать изображения при добавлении статьи.
   - **Добавление кнопок "Опубликовать" и "Отмена"**: Добавлены кнопки "Опубликовать" и "Отмена" для улучшения пользовательского опыта.

4. **news/templates/news/article_detail.html**:
   - **Изменение структуры шаблона**: Удалены лишние контейнеры и добавлены новые элементы для улучшения структуры и визуального оформления шаблона.
   - **Добавление отображения изображения**: Добавлено отображение изображения статьи, если оно существует. Это изменение сделано для улучшения визуального оформления и удобства пользователей.
   - **Добавление кнопок управления**: Добавлены кнопки для редактирования и удаления статьи для улучшения пользовательского опыта.

5. **news/templatetags/customtags.py**:
   - **Добавление фильтра basename**: Добавлен новый фильтр `basename`, который возвращает имя файла без пути. Это изменение сделано для улучшения отображения имен файлов в шаблонах.

### Как это работает:

1. **Определение формы (news/forms.py)**:
   - Форма `ArticleForm` определена с использованием класса `forms.ModelForm`. Она содержит поля `title`, `content`, `category`, `tags` и `image`. Поле `image` использует виджет `ClearableFileInput` для загрузки изображений. Это изменение сделано для того, чтобы пользователи могли загружать изображения при добавлении статьи.

2. **Определение модели (news/models.py)**:
   - В модели `Article` поле `image` использует параметр `upload_to='articles/%Y/%m/%d/'` для сохранения изображений в директории с подкаталогами по году, месяцу и дню. Это изменение сделано для улучшения организации загруженных изображений.

3. **Шаблон для добавления статьи (news/templates/news/add_article.html)**:
   - Шаблон `add_article.html` расширяет базовый шаблон и содержит форму для добавления новой статьи. Форма отправляется методом POST и содержит кнопки "Опубликовать" и "Отмена". Шаблон использует тег `{% csrf_token %}` для защиты от CSRF-атак.
   - Добавлено поле для загрузки изображения с использованием виджета `ClearableFileInput`. Это изменение сделано для того, чтобы пользователи могли загружать изображения при добавлении статьи.

4. **Шаблон для отображения статьи (news/templates/news/article_detail.html)**:
   - Шаблон `article_detail.html` расширяет базовый шаблон и содержит информацию о статье. В шаблоне добавлено отображение изображения статьи, если оно существует. Это изменение сделано для улучшения визуального оформления и удобства пользователей.
   - Добавлены кнопки для редактирования и удаления статьи для улучшения пользовательского опыта.

5. **Фильтр basename (news/templatetags/customtags.py)**:
   - Добавлен новый фильтр `basename`, который возвращает имя файла без пути. Это изменение сделано для улучшения отображения имен файлов в шаблонах.

### Список используемых тегов и стилей с их описанием

1. **HTML теги**:
   - `<div>`: Контейнер для группировки элементов.
   - `<a>`: Гиперссылка для навигации.
   - `<i>`: Иконка для визуального оформления.
   - `<form>`: Форма для отправки данных.
   - `<input>`: Поле ввода для формы.
   - `<button>`: Кнопка для отправки формы.
   - `<h1>`: Заголовок первого уровня.
   - `<img>`: Изображение.
   - `<small>`: Мелкий текст для отображения дополнительной информации.
   - `{% csrf_token %}`: Тег для защиты от CSRF-атак.
   - `{% extends "base.html" %}`: Тег для расширения базового шаблона.
   - `{% block content %}`: Тег для определения блока контента.
   - `{% endblock %}`: Тег для завершения блока контента.
   - `{% include "include/search_form.html" %}`: Тег для включения другого шаблона.
   - `{% for field in form %}`: Тег для цикла по полям формы.
   - `{% endfor %}`: Тег для завершения цикла.
   - `{% if field.errors %}`: Тег для условия проверки наличия ошибок у поля.
   - `{% endif %}`: Тег для завершения условия.

2. **Bootstrap классы**:
   - `container`: Контейнер для центрирования содержимого.
   - `mt-4`: Отступ сверху.
   - `mb-4`: Отступ снизу.
   - `mb-5`: Отступ снизу.
   - `display-4`: Размер заголовка.
   - `text-muted`: Цвет текста (приглушенный).
   - `text-center`: Выравнивание текста по центру.
   - `img-fluid`: Отзывчивое изображение.
   - `rounded-3`: Закругленные углы.
   - `shadow`: Тень.
   - `loading="lazy"`: Ленивая загрузка изображения.
   - `btn btn-warning`: Стиль для кнопки редактирования.
   - `btn btn-danger`: Стиль для кнопки удаления.
   - `btn btn-primary`: Стиль для кнопки "Опубликовать".
   - `btn btn-secondary`: Стиль для кнопки "Отмена".
   - `btn btn-outline-primary`: Стиль для кнопки категории.
   - `btn btn-outline-secondary`: Стиль для кнопки тега.
   - `btn-sm`: Маленькая кнопка.
   - `d-flex`: Флексбокс для горизонтального выравнивания.
   - `flex-wrap`: Перенос элементов на новую строку.
   - `gap-2`: Отступ между элементами.
   - `form-group`: Группа полей формы.
   - `form-label`: Метка поля формы.
   - `form-control-file`: Стиль для поля загрузки файла.
   - `custom-file`: Стиль для пользовательского поля загрузки файла.
   - `custom-file-label`: Стиль для метки пользовательского поля загрузки файла.
   - `form-text`: Текст для описания поля формы.
   - `alert alert-danger`: Стиль для отображения ошибок.
   - `bi bi-pencil-square`: Иконка карандаша для редактирования.
   - `bi bi-trash`: Иконка корзины для удаления.
   - `bi bi-save`: Иконка сохранения.
   - `bi bi-x-circle`: Иконка отмены.
   - `bi bi-bookmark`: Иконка закладки.
   - `bi bi-tag`: Иконка тега.

**commit: `Урок 22: добавили возможность добавления картинки к новости`**