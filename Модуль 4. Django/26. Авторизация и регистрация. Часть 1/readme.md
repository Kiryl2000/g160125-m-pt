## Урок 26

### HTTP
`HTTP` (`HyperText Transfer Protocol`) — это протокол прикладного уровня, используемый для передачи данных в сети, обычно в интернете. Он является основой для обмена данными в веб-браузерах и веб-серверах. `HTTP` работает по модели "запрос-ответ": клиент (например, веб-браузер) отправляет запрос на сервер, а сервер отвечает на этот запрос.

#### Основные методы HTTP
1. `GET`:
   - Используется для запроса данных с сервера.
   - Параметры запроса передаются в URL.
   - Пример: GET /index.html HTTP/1.1
2. `POST`:
   - Используется для отправки данных на сервер, например, при отправке формы.
   - Данные передаются в теле запроса.
   - Пример: POST /submit-form HTTP/1.1
3. `PUT`:
   - Используется для обновления ресурса на сервере.
   - Данные передаются в теле запроса.
   - Пример: PUT /update-resource HTTP/1.1
4. `DELETE`:
   - Используется для удаления ресурса на сервере.
   - Пример: DELETE /delete-resource HTTP/1.1
5. `HEAD`:
   - Аналогичен GET, но сервер возвращает только заголовки ответа без тела.
   - Пример: HEAD /index.html HTTP/1.1
6. `OPTIONS`:
   - Используется для запроса информации о доступных методах и других опциях для указанного ресурса.
   - Пример: OPTIONS /resource HTTP/1.1
7. `PATCH`:
   - Используется для частичного обновления ресурса на сервере.
   - Данные передаются в теле запроса.
   - Пример: PATCH /update-resource HTTP/1.1
8. `TRACE`:
   - Используется для диагностики, возвращает запрос, полученный сервером.
   - Пример: TRACE /resource HTTP/1.1
9. `CONNECT`:
   - Используется для установления туннеля к серверу, обычно для SSL через прокси.
   - Пример: `CONNECT www.example.com:443 HTTP/1.1`

#### Структура `HTTP`-запроса
`HTTP`-запрос состоит из нескольких частей:
1. Стартовая строка:
   - Содержит метод, `URI` (`Uniform Resource Identifier`) и версию протокола.
   - Пример: `GET /index.html HTTP/1.1`
2. Заголовки:
   - Содержат метаинформацию о запросе.
   - Пример: `Host`: `www.example.com`
3. Тело запроса (если есть):
   - Содержит данные, отправляемые на сервер (например, в `POST`-запросе).

#### Структура `HTTP`-ответа
`HTTP`-ответ также состоит из нескольких частей:
1. Стартовая строка:
   - Содержит версию протокола, код состояния и текстовое описание состояния.
   - Пример: `HTTP/1.1 200 OK`
2. Заголовки:
   - Содержат метаинформацию об ответе.
   - Пример: `Content-Type: text/html`
3. Тело ответа (если есть):
   - Содержит данные, возвращаемые сервером (например, `HTML`-страницу).

#### Коды состояния `HTTP`
Коды состояния `HTTP` делятся на несколько категорий:
- `1xx` (Информационные): Запрос получен, продолжается обработка.
- `2xx` (Успешные): Запрос успешно обработан.
- `3xx` (Перенаправления): Для завершения запроса требуется дополнительное действие.
- `4xx` (Ошибки клиента): Запрос содержит ошибку.
- `5xx` (Ошибки сервера): Сервер не смог обработать запрос.

#### Примеры кодов состояния:
- `200 OK`: Запрос успешно обработан.
- `404 Not Found`: Ресурс не найден.
- `500 Internal Server Error`: Внутренняя ошибка сервера.
`HTTP` является основой для работы веб-приложений и веб-сервисов, обеспечивая стандартизированный способ взаимодействия между клиентами и серверами.

**commit: `Урок 26: дополнительная информация по HTTP-протоколу`**

### Users app

- Создано приложение `users` с помощью команды `python manage.py startapp users`.  
- Добавлено приложение `users` в `INSTALLED_APPS` (`settings.py`).  
- Настроены маршруты (`users/urls.py`) и добавлены базовые представления (`users/views.py`).  
- Подключены маршруты `users` в `itg/urls.py` с использованием `namespace='users'`.  

Этот коммит закладывает основу для работы с пользователями, включая аутентификацию через представления `login_user` и `logout_user`.

**commit: `Урок 26: users app и подготовка маршрутов`**

- обновили представление `login_user`:
    - обрабатывает вводимые пользователем данные.
    - выполняет аутентификацию через `authenticate()`.
    - при успешном входе перенаправляет пользователя в `news:catalog`.
- добавили форму `LoginUserPassword` (`users/forms.py`) для обработки входа в систему.
- создали шаблон `users/login.html` с формой входа, основанной на `LoginUserPassword`
- обновили представление `logout_user`:
    - выполняет выход пользователя через `logout()`.
    - перенаправляет пользователя на страницу входа.
- протестировали вход и выход из системы
- нашли в браузере куки и сессии

**commit: `Урок 26: форма входа и аутентификация пользователей`**

- `redirect_field_name = 'next'` во вьюшке добавления карточек
- так же, добавили миксин `LoginRequiredMixin` для защиты представлений от неавторизованных пользователей
- в шаблон `login.html` добавили `next` для перехода на страницу, с которой пришел пользователь `<input type="hidden" name="next" value="{{ request.GET.next }}">`
- изменили редирект при успешной авторизации `return redirect(request.POST.get('next', 'news:catalog'))` — это позволяет переходить на страницу, с которой пришел пользователь после авторизации

**commit: `Урок 26: защита представлений от неавторизованных пользователей и перенаправление`**

- добавили в навигационное меню кнопки `Вход` и `Регистрация`

**commit: `Урок 26: добавили в навигационное меню кнопки Вход и Регистрация`**

### Переписали функцию логина на LoginUser(LoginView)
- Использовали `LoginView` вместо функции `login_user` - это классовое представление для входа в систему
- В нем использовали служебную (встроенную) форму `AuthenticationForm` для входа в систему
- А так же прописали `success_url` для перехода после успешного входа с проверкой на `next`

**commit: `Урок 26: переписали функцию логина на LoginUser(LoginView)`**

- Написали свою форму с наследованием от `AuthenticationForm` и добавили в нее `BS5` стили
- Добавили оформления в шаблон `login.html`

**commit: `Урок 26: своя форма входа в систему`**

- Прописал в настройках `LOGIN_URL` для того, чтобы не делать это в каждом защищенном представлении
- Убрал `login_url` из защищенного представления и проверил работу
- `LoginRequiredMixin` работает в связке с полем |`login_url` из защищённого представления или с параметром `LOGIN_URL` из настроек

**commit: `Урок 26: LoginRequiredMixin и LOGIN_URL`**