## Урок 21

### Формы в Django

- Создали форму не связанную с моделью. Форма для добавления карточек
- Создали представление, обрабатывающее метод `POST` и возвращающее форму
- Создали шаблон для формы
- Протестировали работу формы
- Проверили валидацию формы

1. **news/forms.py**:
   - **Создание формы ArticleForm**: Создан новый файл `forms.py` с определением формы `ArticleForm`. Форма содержит два поля: `title` (заголовок) и `content` (содержание). Поле `title` имеет максимальную длину 255 символов, а поле `content` использует виджет `Textarea` и имеет максимальную длину 5000 символов. Это изменение сделано для создания формы, которая позволяет пользователям добавлять новые статьи.

2. **news/templates/news/add_article.html**:
   - **Создание шаблона для добавления статьи**: Создан новый шаблон `add_article.html`, который расширяет базовый шаблон и содержит форму для добавления новой статьи. Форма отправляется методом POST и содержит кнопку отправки. Это изменение сделано для предоставления пользователям интерфейса для добавления новых статей.

3. **news/urls.py**:
   - **Добавление нового маршрута для добавления статьи**: Добавлен новый маршрут `path('add/', views.add_article, name='add_article')` для обработки запросов на добавление новой статьи. Это изменение сделано для поддержки новой функциональности добавления статей.

4. **news/views.py**:
   - **Импорт HttpResponseRedirect и ArticleForm**: Добавлены импорты `HttpResponseRedirect` и `ArticleForm` для использования в представлениях.
   - **Добавление функции add_article**: Добавлена новая функция `add_article`, которая обрабатывает запросы на добавление новой статьи. Функция проверяет метод запроса (POST или GET), создает экземпляр формы `ArticleForm`, проверяет валидность данных формы и перенаправляет пользователя на главную страницу при успешной отправке формы. Это изменение сделано для реализации функциональности добавления новых статей.

### Для чего нужны формы?

**Формы в Django**:
Формы в `Django` используются для обработки и валидации данных, введенных пользователями. Они позволяют разработчикам легко создавать `HTML`-формы, обрабатывать данные формы и выполнять валидацию. Формы могут быть использованы для различных целей, таких как создание, обновление и удаление данных в базе данных.

**Как работает этот код**:

1. **Определение формы (news/forms.py)**:
   - Форма `ArticleForm` определена с использованием класса `forms.Form`. Она содержит два поля: `title` и `content`. Поле `title` использует виджет `CharField` с максимальной длиной 255 символов, а поле `content` использует виджет `Textarea` с максимальной длиной 5000 символов.

2. **Шаблон для добавления статьи (news/templates/news/add_article.html)**:
   - Шаблон `add_article.html` расширяет базовый шаблон и содержит форму для добавления новой статьи. Форма отправляется методом POST и содержит кнопку отправки. Шаблон использует тег `{% csrf_token %}` для защиты от CSRF-атак.

3. **Маршрут для добавления статьи (news/urls.py)**:
   - Добавлен новый маршрут `path('add/', views.add_article, name='add_article')` для обработки запросов на добавление новой статьи. Маршрут связывает URL `/add/` с представлением `add_article`.

4. **Представление для добавления статьи (news/views.py)**:
   - Функция `add_article` обрабатывает запросы на добавление новой статьи. Она проверяет метод запроса (POST или GET). Если метод POST, создается экземпляр формы `ArticleForm` с данными из запроса, проверяется валидность данных формы и, при успешной валидации, пользователь перенаправляется на главную страницу. Если метод GET, создается пустой экземпляр формы `ArticleForm`. Контекст содержит форму и меню, и шаблон `add_article.html` рендерится с этим контекстом.

### Список используемых тегов, стилей, классов и функций с их описанием

1. **HTML теги**:
   - `<form>`: Форма для отправки данных.
   - `<input>`: Поле ввода для формы.
   - `<button>`: Кнопка для отправки формы.
   - `<h1>`: Заголовок первого уровня.
   - `{% csrf_token %}`: Тег для защиты от CSRF-атак.
   - `{% extends "base.html" %}`: Тег для расширения базового шаблона.
   - `{% block content %}`: Тег для определения блока контента.
   - `{% endblock %}`: Тег для завершения блока контента.

2. **Django теги**:
   - `{% csrf_token %}`: Тег для защиты от CSRF-атак.
   - `{{ form.as_p }}`: Тег для отображения формы в виде абзацев.

3. **Django классы**:
   - `forms.Form`: Класс для создания формы.
   - `forms.CharField`: Класс для создания текстового поля.
   - `forms.Textarea`: Класс для создания текстовой области.
   - `HttpResponseRedirect`: Класс для перенаправления HTTP-запросов.
   - `get_object_or_404`: Функция для получения объекта или возврата ошибки 404.
   - `redirect`: Функция для перенаправления.
   - `render`: Функция для рендеринга шаблона.

**commit: `Урок 21: базовая форма для добавления карточек`**

- Дополнили шаблон с построчным рендером полей ввода
- Добавили категорию как выпадающий список `form.ChoiceField`

1. **news/forms.py**:
   - **Импорт модели Category**: Добавлен импорт модели `Category` для использования в форме.
   - **Добавление поля category в ArticleForm**: В форму `ArticleForm` добавлено новое поле `category`, которое является выпадающим списком (`ModelChoiceField`). Поле использует все объекты модели `Category` в качестве вариантов выбора. Поле обязательно для заполнения и имеет метку `Категория` и пустое значение `Категория не выбрана`. Это изменение сделано для того, чтобы пользователи могли выбирать категорию для новой статьи при её добавлении.

2. **news/templates/news/add_article.html**:
   - **Изменение отображения формы**: В шаблоне `add_article.html` изменено отображение формы. Теперь каждое поле формы отображается отдельно с использованием цикла `{% for field in form %}`. Для каждого поля отображается метка (`label_tag`) и само поле (`field`). Если у поля есть ошибки, они отображаются в элементе `<div class="error">`. Это изменение сделано для улучшения отображения формы и удобства пользователей при заполнении формы.
   - **Изменение кнопки отправки**: Кнопка отправки формы изменена с `<button type="submit">Добавить</button>` на `<input type="submit" value="Отправить">`. Это изменение сделано для улучшения визуального оформления и удобства пользователей.

### Список используемых тегов и стилей с их описанием

1. **HTML теги**:
   - `{% for field in form %}`: Тег для цикла по полям формы.
   - `{% if field.errors %}`: Тег для условия проверки наличия ошибок у поля.

2. **Django теги**:
   - `{{ form.as_p }}`: Тег для отображения формы в виде абзацев.
   - `{{ field.label_tag }}`: Тег для отображения метки поля.
   - `{{ field }}`: Тег для отображения самого поля.
   - `{{ field.errors }}`: Тег для отображения ошибок поля.

**commit: `Урок 21: дополнили шаблон с построчным рендером полей ввода`**

- Передали классы и атрибуты в форму через класс формы
- Добавили обработку формы и сохранение данных в представлении

1. **news/forms.py**:
   - **Изменение поля title**: В поле `title` формы `ArticleForm` добавлены атрибуты `max_length=100` и `widget=forms.TextInput(attrs={'class': 'form-control'})`. Это изменение сделано для ограничения длины заголовка до 100 символов и добавления стиля Bootstrap для текстового поля.
   - **Изменение поля content**: В поле `content` формы `ArticleForm` добавлены атрибуты `widget=forms.Textarea(attrs={'class': 'form-control', 'rows': 5, 'cols': 40})`. Это изменение сделано для добавления стиля Bootstrap для текстовой области и установки размеров текстовой области.
   - **Изменение поля category**: В поле `category` формы `ArticleForm` добавлен атрибут `widget=forms.Select(attrs={'class': 'form-control'})`. Это изменение сделано для добавления стиля Bootstrap для выпадающего списка.

2. **news/templates/news/add_article.html**:
   - **Изменение заголовка**: Заголовок страницы изменен с "Добавить новость" на "Предложить новость". Это изменение сделано для улучшения пользовательского опыта.
   - **Добавление контейнера и строки**: Добавлены контейнер `<div class="container-fluid">` и строка `<div class="row">` для улучшения структуры страницы.
   - **Добавление колонки для формы**: Добавлена колонка `<div class="col-12 col-lg-6">` для формы редактирования. Это изменение сделано для улучшения структуры страницы и удобства пользователей.
   - **Изменение отображения полей формы**: В цикле `{% for field in form %}` изменено отображение полей формы. Теперь каждое поле отображается в элементе `<div class="mb-3">` с меткой и самим полем. Если у поля есть ошибки, они отображаются в элементе `<div class="alert alert-danger mt-1">`. Это изменение сделано для улучшения визуального оформления и удобства пользователей.
   - **Добавление кнопки отправки**: Кнопка отправки формы изменена на `<button type="submit" class="btn btn-dark">Отправить</button>`. Это изменение сделано для улучшения визуального оформления и удобства пользователей.
   - **Добавление колонки с подсказкой**: Добавлена колонка `<div class="col-12 col-lg-6">` с подсказкой по заполнению формы. Это изменение сделано для улучшения пользовательского опыта и предоставления пользователям инструкций по заполнению формы.

3. **news/views.py**:
   - **Изменение функции add_article**: В функции `add_article` добавлены строки для сохранения статьи в базе данных. Теперь при успешной валидации формы создается объект `Article` с данными из формы и сохраняется в базе данных. После сохранения статьи пользователь перенаправляется на страницу карточки новости. Это изменение сделано для реализации функциональности добавления новых статей и сохранения их в базе данных.

### Список используемых классов с их описанием

3. **Bootstrap классы**:
   - `form-control`: Стиль для текстового поля.
   - `form-label`: Стиль для метки поля.
   - `alert alert-danger`: Стиль для отображения ошибок.
   - `btn btn-dark`: Стиль для кнопки отправки формы.
   - `container-fluid`: Контейнер для жидкой верстки.
   - `row`: Строка для размещения колонок.
   - `col-12 col-lg-6`: Колонка для размещения элементов.
   - `mb-3`: Отступ снизу.
   - `mt-1`: Отступ сверху.

**commit: `Урок 21: сохранение данных из формы`**